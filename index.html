<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Controle de Validade ‚Ä¢ Palato</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="palato-logo.png" />

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.10/minified/html5-qrcode.min.js"></script>

  <style>
    :root {
      --bg-main: #050509;
      --bg-card: #11141b;
      --bg-card-alt: #181b23;
      --accent-red: #e30613;
      --accent-red-soft: #ff4b5c;
      --border-soft: #262a33;
      --text-main: #ffffff;
      --text-soft: #9ca3af;
      --badge-bg: #1f2933;
      --badge-red-bg: #3b0710;
      --badge-red-border: #ff4b5c;
      --badge-green-bg: #073b1f;
      --badge-green-border: #4ade80;
      --input-bg: #050509;
      --input-border: #272a33;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #111827 0, #050509 45%, #000 100%);
      color: var(--text-main);
    }

    /* ===== LOGIN ===== */

    #loginView {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .login-card {
      width: 100%;
      max-width: 420px;
      background: rgba(8, 10, 20, 0.98);
      border-radius: 24px;
      padding: 32px 28px 28px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    .login-logo {
      display: flex;
      justify-content: center;
      margin-bottom: 16px;
    }

    .login-logo img {
      height: 32px;
    }

    .login-title {
      text-align: center;
      margin-bottom: 4px;
      font-size: 20px;
      letter-spacing: 0.12em;
    }

    .login-subtitle {
      text-align: center;
      margin-bottom: 24px;
      font-size: 13px;
      color: var(--text-soft);
    }

    .form-group {
      margin-bottom: 14px;
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
      color: var(--text-soft);
    }

    input[type="email"],
    input[type="password"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text-main);
      font-size: 14px;
    }

    input::placeholder {
      color: #4b5563;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.08s ease;
    }

    .btn-primary {
      width: 100%;
      background: var(--accent-red);
      color: #fff;
      margin-top: 6px;
      box-shadow: 0 10px 30px rgba(227, 6, 19, 0.5);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 34px rgba(227, 6, 19, 0.7);
    }

    .btn-google {
      width: 100%;
      margin-top: 10px;
      background: #111827;
      color: #e5e7eb;
      border: 1px solid #374151;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-google img {
      height: 16px;
    }

    .login-footer {
      margin-top: 14px;
      font-size: 12px;
      color: #6b7280;
      text-align: center;
    }

    /* ===== APP MAIN ===== */

    #appView {
      display: none;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: linear-gradient(135deg, #000 0%, #050509 40%, #020617 100%);
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 24px;
      background: #000;
      border-bottom: 1px solid #111827;
    }

    .app-header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-palato {
      height: 28px;
      display: block;
    }

    .app-title h1 {
      font-size: 16px;
      margin: 0;
      letter-spacing: 0.15em;
      text-transform: uppercase;
    }

    .app-title span {
      font-size: 11px;
      color: var(--text-soft);
    }

    .header-menu-toggle {
      display: none;
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 18px;
      align-items: center;
      justify-content: center;
      margin-right: 4px;
      cursor: pointer;
    }

    .user-box {
      text-align: right;
      font-size: 13px;
    }

    .user-box strong {
      display: block;
      font-size: 14px;
    }

    .user-profile-label {
      color: var(--accent-red-soft);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .user-box a {
      color: #f97373;
      font-size: 12px;
      cursor: pointer;
      text-decoration: none;
    }

    .app-main {
      display: flex;
      flex: 1;
      min-height: 0;
    }

    .side-menu {
      width: 260px;
      background: #000;
      padding: 24px 16px;
      border-right: 1px solid #111827;
      z-index: 40;
    }

    .side-menu-title {
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .menu-item {
      width: 100%;
      border-radius: 999px;
      border: none;
      text-align: left;
      padding: 12px 16px;
      margin-bottom: 12px;
      font-size: 14px;
      font-weight: 500;
      color: #fff;
      background: var(--accent-red);
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(227, 6, 19, 0.45);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .menu-item span.icon {
      font-size: 18px;
    }

    .menu-item-secondary {
      background: #050509;
      color: var(--text-soft);
      border: 1px solid #1f2933;
      box-shadow: none;
    }

    .menu-item-active {
      outline: 2px solid rgba(255, 255, 255, 0.12);
      outline-offset: 2px;
    }

    .app-content {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }

    .app-view {
      display: none;
    }

    .app-view-active {
      display: block;
    }

    /* MENU OVERLAY MOBILE */
    .menu-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      z-index: 35;
    }
    .menu-overlay.show {
      display: block;
    }

    /* CARDS */

    .card {
      background: radial-gradient(circle at top left, #111827 0, #050509 45%, #000 100%);
      border-radius: 18px;
      padding: 18px 20px 18px;
      border: 1px solid rgba(148, 163, 184, 0.16);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.8);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      font-weight: 600;
    }

    .card-title-icon {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: rgba(227, 6, 19, 0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent-red-soft);
      font-size: 14px;
    }

    .card-subtitle {
      font-size: 13px;
      color: var(--text-soft);
    }

    /* GRIDS / FORM */

    .grid-two-columns {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 16px;
    }

    .grid-two {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    select,
    input[type="number"],
    input[type="text"],
    input[type="date"],
    textarea {
      width: 100%;
      padding: 9px 10px;
      border-radius: 10px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text-main);
      font-size: 14px;
    }

    select {
      cursor: pointer;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .input-inline-btn {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .btn-icon {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      border: 1px solid var(--input-border);
      background: #020617;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
    }

    .btn-save {
      background: #16a34a;
      color: #fff;
      box-shadow: 0 12px 30px rgba(22, 163, 74, 0.55);
    }

    /* TABELA ITENS */

    .filters-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 12px;
      font-size: 13px;
      color: var(--text-soft);
    }

    .filters-row label {
      margin-bottom: 0;
    }

    .filters-row select {
      width: auto;
      min-width: 150px;
      padding: 6px 10px;
      font-size: 13px;
    }

    .btn-ghost {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #374151;
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 999px;
      cursor: pointer;
    }

    .btn-export {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #020617;
      border-radius: 999px;
      border: 1px solid #374151;
      padding: 6px 12px;
      color: #e5e7eb;
      font-size: 13px;
      cursor: pointer;
    }

    .btn-export span.icon {
      font-size: 14px;
    }

    .items-table-wrapper {
      border-radius: 14px;
      border: 1px solid #1f2933;
      overflow-x: auto;
      overflow-y: hidden;
      background: #020617;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    thead {
      background: #020617;
    }

    th,
    td {
      padding: 8px 10px;
      border-bottom: 1px solid #111827;
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-weight: 500;
      color: #9ca3af;
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
    }

    tbody tr:nth-child(even) {
      background: #020617;
    }

    tbody tr:nth-child(odd) {
      background: #050815;
    }

    .badge-status {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 120px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      text-align: center;
      white-space: normal;
      background: var(--badge-bg);
      border: 1px solid #4b5563;
    }

    .badge-status-danger {
      background: var(--badge-red-bg);
      border-color: var(--badge-red-border);
      color: #fecaca;
    }

    .badge-status-warning {
      background: #3b2607;
      border-color: #facc15;
      color: #fef9c3;
    }

    .badge-status-ok {
      background: var(--badge-green-bg);
      border-color: var(--badge-green-border);
      color: #bbf7d0;
    }

    .badge-oferta {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 100px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      cursor: pointer;
      border: 1px solid #4b5563;
      background: #020617;
    }

    .badge-oferta-lancado {
      background: #065f46;
      border-color: #34d399;
      color: #bbf7d0;
    }

    .actions-cell button {
      background: transparent;
      border: none;
      color: #facc15;
      font-size: 12px;
      cursor: pointer;
      padding: 0;
      margin-right: 8px;
    }

    .actions-cell button.btn-delete {
      color: #fb7185;
    }

    .items-footer {
      margin-top: 8px;
      font-size: 12px;
      color: #9ca3af;
      text-align: right;
    }

    /* ADMIN USU√ÅRIOS */

    .users-table-wrapper {
      border-radius: 12px;
      border: 1px solid #1f2933;
      overflow: hidden;
      background: #020617;
      margin-top: 12px;
    }

    .users-table-wrapper table th,
    .users-table-wrapper table td {
      font-size: 13px;
    }

    /* MODAL SCANNER */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.78);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal-backdrop.show {
      display: flex;
    }

    .modal {
      background: #050509;
      border-radius: 18px;
      border: 1px solid #374151;
      padding: 16px;
      width: 100%;
      max-width: 360px;
      color: #e5e7eb;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 15px;
    }

    .modal-close {
      background: transparent;
      border: none;
      color: #9ca3af;
      cursor: pointer;
      font-size: 18px;
    }

    #qr-reader {
      width: 100%;
      min-height: 260px;
      border-radius: 12px;
      overflow: hidden;
      background: #000;
    }

    /* ===== RESPONSIVO ===== */
    @media (max-width: 960px) {
      .side-menu {
        position: fixed;
        left: -280px;
        top: 56px;
        bottom: 0;
        width: 260px;
        padding: 20px 16px;
        transition: left 0.2s ease;
      }
      .side-menu.open {
        left: 0;
      }
      .header-menu-toggle {
        display: flex;
      }
      .app-main {
        flex-direction: column;
      }
      .app-content {
        padding: 16px;
      }
      .grid-two-columns {
        grid-template-columns: minmax(0, 1fr);
      }
      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .card-header > div:last-child {
        align-self: stretch;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        justify-content: flex-start;
      }
      .btn-ghost,
      .btn-export {
        font-size: 12px;
        padding: 5px 10px;
      }
      table {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div id="loginView">
    <div class="login-card">
      <div class="login-logo">
        <img src="palato-logo.png" alt="Palato" />
      </div>
      <div class="login-title">Controle de Validade</div>
      <div class="login-subtitle">Acesso restrito a colaboradores autorizados.</div>

      <div class="form-group">
        <label for="loginEmail">E-mail *</label>
        <input id="loginEmail" type="email" placeholder="seu.email@palato.com.br" />
      </div>
      <div class="form-group">
        <label for="loginSenha">Senha *</label>
        <input id="loginSenha" type="password" placeholder="Digite sua senha" />
      </div>
      <button id="btnLoginEmail" class="btn btn-primary">Entrar</button>

      <button id="btnLoginGoogle" class="btn btn-google">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" />
        Entrar com Google
      </button>

      <div class="login-footer">D√∫vidas? Procure a √°rea de Compras / TI.</div>
    </div>
  </div>

  <div id="appView">
    <header class="app-header">
      <div class="app-header-left">
        <button id="btnToggleMenu" class="header-menu-toggle">‚ò∞</button>
        <img src="palato-logo.png" alt="Palato" class="logo-palato" />
        <div class="app-title">
          <h1>CONTROLE DE VALIDADE</h1>
          <span>Multi-loja ‚Ä¢ Lote ‚Ä¢ Ofertas</span>
        </div>
      </div>
      <div class="user-box" id="userBox"></div>
    </header>

    <div id="menuOverlay" class="menu-overlay"></div>

    <main class="app-main">
      <nav class="side-menu">
        <div class="side-menu-title">Menu</div>
        <button id="menu-novo" class="menu-item menu-item-active">
          <span class="icon">Ôºã</span>
          <span>Novo lan√ßamento</span>
        </button>
        <button id="menu-itens" class="menu-item">
          <span class="icon">üìã</span>
          <span>Itens cadastrados</span>
        </button>
        <button id="menu-usuarios" class="menu-item menu-item-secondary">
          <span class="icon">‚öôÔ∏è</span>
          <span>Gerenciar usu√°rios</span>
        </button>
      </nav>

      <section class="app-content">
        <div id="view-novo" class="app-view app-view-active">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">
                  <div class="card-title-icon">Ôºã</div>
                  <span>Novo lan√ßamento</span>
                </div>
                <div class="card-subtitle">
                  Registrar validade por loja, departamento e lote.
                </div>
              </div>
              <div id="novoLancamentoStatus" class="card-subtitle">
                ‚Ä¢ Cadastro r√°pido
              </div>
            </div>

            <div class="grid-two-columns">
              <div>
                <div class="grid-two">
                  <div class="form-group">
                    <label for="novaLoja">Loja *</label>
                    <select id="novaLoja">
                      <option value="">Selecione</option>
                      <option>Ponta Verde</option>
                      <option>Farol</option>
                      <option>Praia</option>
                      <option>Riomar</option>
                      <option>CD</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="dataLancamento">Data lan√ßamento *</label>
                    <input id="dataLancamento" type="text" readonly />
                  </div>
                </div>

                <div class="grid-two">
                  <div class="form-group">
                    <label for="departamento">Departamento *</label>
                    <select id="departamento">
                      <option value="">Selecione</option>
                      <option>A√ßougue</option>
                      <option>Adega</option>
                      <option>Bebidas</option>
                      <option>Mercearia Alimentos</option>
                      <option>Mercearia N√£o Alimentos</option>
                      <option>Perec√≠veis Processados</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="codigoBarras">C√≥d. barras (n√∫meros, m√°x. 13) *</label>
                    <div class="input-inline-btn">
                      <input
                        id="codigoBarras"
                        type="text"
                        maxlength="13"
                        inputmode="numeric"
                        pattern="[0-9]*"
                        placeholder="789..."
                      />
                      <button id="btnScan" type="button" class="btn-icon" title="Ler c√≥digo de barras">
                        üì∑
                      </button>
                    </div>
                  </div>
                </div>

                <div class="grid-two">
                  <div class="form-group">
                    <label for="descricao">Descri√ß√£o *</label>
                    <input id="descricao" type="text" />
                  </div>
                  <div class="form-group">
                    <label for="lote">Lote</label>
                    <input id="lote" type="text" />
                  </div>
                </div>

                <div class="grid-two">
                  <div class="form-group">
                    <label for="quantidade">Quantidade *</label>
                    <input id="quantidade" type="number" min="1" />
                  </div>
                  <div class="form-group">
                    <label for="validade">Validade *</label>
                    <input id="validade" type="date" />
                  </div>
                </div>

                <div class="form-group">
                  <label for="observacao">Observa√ß√£o</label>
                  <textarea
                    id="observacao"
                    placeholder="Lote em oferta, ponto extra, etc."
                  ></textarea>
                </div>

                <div style="margin-top: 8px; text-align: right;">
                  <button id="btnSalvarLancamento" class="btn btn-save">
                    üíæ Salvar lan√ßamento
                  </button>
                </div>
              </div>

              <div></div>
            </div>
          </div>
        </div>

        <div id="view-itens" class="app-view">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">
                  <div class="card-title-icon">üìã</div>
                  <span>Itens cadastrados</span>
                </div>
                <div class="card-subtitle">
                  Filtros por status de vencimento e controle de oferta.
                </div>
              </div>
              <div style="display:flex; gap:8px; align-items:center;">
                <button id="btnMarcarTodosOferta" class="btn-ghost">
                  üì£ Marcar todos como oferta
                </button>
                <button id="btnExportExcel" class="btn-export">
                  <span class="icon">üìä</span><span>Excel</span>
                </button>
                <button id="btnExportPDF" class="btn-export">
                  <span class="icon">üìÑ</span><span>PDF</span>
                </button>
              </div>
            </div>

            <div class="filters-row">
              <label for="filtroStatus">Status:</label>
              <select id="filtroStatus">
                <option value="todos">Todos</option>
                <option value="7">Vence em 7 dias</option>
                <option value="15">Vence em 15 dias</option>
                <option value="30">Vence em 30 dias</option>
                <option value="vencidos">Vencidos</option>
              </select>

              <label for="filtroDepartamento">‚Ä¢ Departamento:</label>
              <select id="filtroDepartamento">
                <option value="todos">Todos departamentos</option>
                <option>A√ßougue</option>
                <option>Adega</option>
                <option>Bebidas</option>
                <option>Mercearia Alimentos</option>
                <option>Mercearia N√£o Alimentos</option>
                <option>Perec√≠veis Processados</option>
              </select>

              <label for="filtroOferta">‚Ä¢ Oferta:</label>
              <select id="filtroOferta">
                <option value="todos">Todos</option>
                <option value="lancado">Lan√ßados</option>
                <option value="nao_lancado">N√£o lan√ßados</option>
              </select>
            </div>

            <div class="items-table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Data lan√ßamento</th>
                    <th>Loja</th>
                    <th>C√≥d. barras</th>
                    <th>Descri√ß√£o</th>
                    <th>Lote</th>
                    <th>Qtd</th>
                    <th>Validade</th>
                    <th>Obs.</th>
                    <th>Oferta</th>
                    <th>Departamento</th>
                    <th>Status</th>
                    <th>Usu√°rio</th>
                    <th>Lan√ßado em</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody id="tabelaItensBody"></tbody>
              </table>
            </div>
            <div class="items-footer">
              Total de itens: <span id="totalItens">0</span>
            </div>
          </div>
        </div>

        <div id="view-usuarios" class="app-view">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">
                  <div class="card-title-icon">üõ°Ô∏è</div>
                  <span>Administra√ß√£o de usu√°rios</span>
                </div>
                <div class="card-subtitle">
                  Gerencie perfis (admin, gerente, repositor) e lojas vinculadas.
                </div>
              </div>
              <button id="btnReloadUsuarios" class="btn-ghost">üîÑ Recarregar</button>
            </div>

            <div class="grid-two">
              <div class="form-group">
                <label for="novoUsuarioNome">Nome</label>
                <input id="novoUsuarioNome" type="text" />
              </div>
              <div class="form-group">
                <label for="novoUsuarioEmail">E-mail</label>
                <input id="novoUsuarioEmail" type="email" />
              </div>
            </div>

            <div class="grid-two" style="margin-top:10px;">
              <div class="form-group">
                <label for="novoUsuarioPerfil">Perfil</label>
                <select id="novoUsuarioPerfil">
                  <option value="repositor">Repositor</option>
                  <option value="gerente">Gerente</option>
                  <option value="admin">Admin</option>
                </select>
              </div>
              <div class="form-group">
                <label for="novoUsuarioLoja">Loja</label>
                <select id="novoUsuarioLoja">
                  <option value="">Nenhuma</option>
                  <option>Ponta Verde</option>
                  <option>Farol</option>
                  <option>Praia</option>
                  <option>Riomar</option>
                  <option>CD</option>
                </select>
              </div>
            </div>

            <div class="form-group" style="margin-top:10px; text-align:right;">
              <button id="btnSalvarUsuario" class="btn btn-save">üíæ Salvar usu√°rio</button>
            </div>

            <div class="users-table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>E-mail</th>
                    <th>Perfil</th>
                    <th>Loja</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody id="usuariosBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="scannerModal" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h3>Leitor de c√≥digo de barras</h3>
        <button class="modal-close" id="btnCloseScanner">√ó</button>
      </div>
      <div id="qr-reader"></div>
      <div style="margin-top:8px; font-size:11px; color:#9ca3af;">
        Aponte para o c√≥digo de barras (EAN-13). A c√¢mera traseira ser√° usada quando poss√≠vel.
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      signInWithPopup,
      GoogleAuthProvider,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
    import {
      getFirestore,
      collection,
      doc,
      getDoc,
      getDocs,
      setDoc,
      updateDoc,
      deleteDoc,
      addDoc,
      query,
      orderBy,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    // ===== CONFIG FIREBASE =====
    const firebaseConfig = {
      apiKey: "AIzaSyDa1z9LwlSHxwSTC974ci9RMEYdEiA_wEg",
      authDomain: "controle-validade-fc108.firebaseapp.com",
      projectId: "controle-validade-fc108",
      storageBucket: "controle-validade-fc108.firebasestorage.app",
      messagingSenderId: "737065688686",
      appId: "1:737065688686:web:ed3e602baf64c1fb4f907f",
      measurementId: "G-VJ8DMM47EN"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const googleProvider = new GoogleAuthProvider();

    // ===== ELEMENTOS =====
    const loginView = document.getElementById("loginView");
    const appView = document.getElementById("appView");

    const loginEmail = document.getElementById("loginEmail");
    const loginSenha = document.getElementById("loginSenha");
    const btnLoginEmail = document.getElementById("btnLoginEmail");
    const btnLoginGoogle = document.getElementById("btnLoginGoogle");

    const userBox = document.getElementById("userBox");

    const menuNovo = document.getElementById("menu-novo");
    const menuItens = document.getElementById("menu-itens");
    const menuUsuarios = document.getElementById("menu-usuarios");

    const viewNovo = document.getElementById("view-novo");
    const viewItens = document.getElementById("view-itens");
    const viewUsuarios = document.getElementById("view-usuarios");

    const sideMenu = document.querySelector(".side-menu");
    const menuOverlay = document.getElementById("menuOverlay");
    const btnToggleMenu = document.getElementById("btnToggleMenu");

    // Novo lan√ßamento
    const novaLoja = document.getElementById("novaLoja");
    const dataLancamento = document.getElementById("dataLancamento");
    const departamento = document.getElementById("departamento");
    const codigoBarras = document.getElementById("codigoBarras");
    const descricao = document.getElementById("descricao");
    const lote = document.getElementById("lote");
    const quantidade = document.getElementById("quantidade");
    const validade = document.getElementById("validade");
    const observacao = document.getElementById("observacao");
    const btnSalvarLancamento = document.getElementById("btnSalvarLancamento");
    const btnScan = document.getElementById("btnScan");

    // Itens cadastrados
    const tabelaItensBody = document.getElementById("tabelaItensBody");
    const totalItensSpan = document.getElementById("totalItens");
    const filtroStatus = document.getElementById("filtroStatus");
    const filtroDepartamento = document.getElementById("filtroDepartamento");
    const filtroOferta = document.getElementById("filtroOferta");
    const btnMarcarTodosOferta = document.getElementById("btnMarcarTodosOferta");
    const btnExportExcel = document.getElementById("btnExportExcel");
    const btnExportPDF = document.getElementById("btnExportPDF");

    // Usu√°rios
    const usuariosBody = document.getElementById("usuariosBody");
    const novoUsuarioNome = document.getElementById("novoUsuarioNome");
    const novoUsuarioEmail = document.getElementById("novoUsuarioEmail");
    const novoUsuarioPerfil = document.getElementById("novoUsuarioPerfil");
    const novoUsuarioLoja = document.getElementById("novoUsuarioLoja");
    const btnSalvarUsuario = document.getElementById("btnSalvarUsuario");
    const btnReloadUsuarios = document.getElementById("btnReloadUsuarios");

    // Scanner modal
    const scannerModal = document.getElementById("scannerModal");
    const btnCloseScanner = document.getElementById("btnCloseScanner");
    
    // CORRE√á√ÉO: Inicialize a vari√°vel html5Qr com a inst√¢ncia de Html5Qrcode
    let html5QrCode; // Declara a vari√°vel aqui

    // Inicializa√ß√£o (exemplo simplificado, voc√™ precisar√° adapt√°-lo ao seu c√≥digo)
    document.addEventListener('DOMContentLoaded', () => {
        // Inicializa o Html5Qrcode depois que o DOM estiver carregado
        html5QrCode = new Html5Qrcode("qr-reader");

        // ... outras inicializa√ß√µes ...
        
        // Adiciona o listener de clique ao bot√£o de scan
        btnScan.addEventListener('click', handleScanButtonClick);
        btnCloseScanner.addEventListener('click', closeScannerModal);
        // ...
    });

    // Fun√ß√£o que lida com o clique no bot√£o de scan
    function handleScanButtonClick() {
        scannerModal.classList.add('show');
        startScanner();
    }

    // Fun√ß√£o para fechar o modal e parar o scanner
    function closeScannerModal() {
        scannerModal.classList.remove('show');
        if (html5QrCode) {
            html5QrCode.stop().catch(err => {
                console.error("Erro ao parar o scanner:", err);
            });
        }
    }

    // Fun√ß√£o que inicia o scanner
    function startScanner() {
        const qrCodeSuccessCallback = (decodedText, decodedResult) => {
            // L√≥gica para quando um c√≥digo √© lido com sucesso
            codigoBarras.value = decodedText;
            closeScannerModal();
            console.log(`C√≥digo lido: ${decodedText}`);
        };

        const config = {
            fps: 10,
            qrbox: { width: 250, height: 100 },
            // Preferir a c√¢mera traseira se dispon√≠vel
            facingMode: "environment" 
        };

        if (html5QrCode && !html5QrCode.isScanning) {
            html5QrCode.start(
                { facingMode: "environment" }, 
                config, 
                qrCodeSuccessCallback,
                (errorMessage) => {
                    // Lidar com erros de leitura em tempo real (opcional)
                    console.error("Erro de leitura: ", errorMessage);
                }
            ).catch(err => {
                console.error("Erro ao iniciar o scanner:", err);
                alert("N√£o foi poss√≠vel iniciar a c√¢mera. Verifique as permiss√µes.");
            });
        }
    }

    // O restante do seu c√≥digo JavaScript aqui...
    // ...

    // O c√≥digo original terminava abruptamente aqui, vou completar com o fechamento do script:
  </script>
</body>
</html>
