<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Controle de Validade</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg-main: #020617;
      --bg-card: #020617;
      --bg-card-alt: #020617;
      --accent: #22c55e;
      --accent-strong: #16a34a;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --danger: #f97373;
      --danger-soft: rgba(248, 113, 113, 0.16);
      --warning: #facc15;
      --warning-soft: rgba(250, 204, 21, 0.13);
      --border-soft: #111827;
      --row-alt: #020617;
      --row-alt-2: #020617;
      --chip-bg: #020617;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: var(--bg-main);
      color: var(--text-main);
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 10px 32px;
      background: #020617;
      border-bottom: 1px solid #0f172a;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: #22c55e;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: #022c22;
      font-size: 13px;
    }

    .brand-text-title {
      font-size: 16px;
      font-weight: 600;
    }

    .brand-text-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .user-info {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
      font-size: 12px;
    }

    .user-role {
      color: var(--text-muted);
      font-size: 11px;
    }

    .link-logout {
      font-size: 11px;
      color: var(--danger);
      cursor: pointer;
      text-decoration: none;
    }

    main {
      flex: 1;
      padding: 20px 32px 32px;
      max-width: 1280px;
      margin: 0 auto;
      width: 100%;
    }

    @media (max-width: 960px) {
      main {
        padding: 16px;
      }
      header {
        padding: 10px 16px;
      }
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 2fr);
      gap: 16px;
      align-items: flex-start;
    }

    @media (max-width: 960px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--bg-card);
      border-radius: 10px;
      padding: 14px 14px 16px;
      border: 1px solid var(--border-soft);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title-icon {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: #0f172a;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .badge-soft {
      padding: 3px 8px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
      font-size: 11px;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .badge-soft-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 12px;
    }

    @media (max-width: 960px) {
      .form-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 3px;
      font-size: 12px;
    }

    label {
      color: var(--text-muted);
    }

    .required-star {
      color: var(--danger);
      margin-left: 2px;
    }

    input,
    select,
    textarea {
      background: #020617;
      border-radius: 6px;
      border: 1px solid #1f2937;
      padding: 7px 9px;
      color: var(--text-main);
      font-size: 13px;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.35);
    }

    input[readonly] {
      opacity: 0.7;
    }

    textarea {
      resize: vertical;
      min-height: 50px;
      max-height: 120px;
    }

    .input-inline {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border-radius: 999px;
      border: none;
      padding: 6px 14px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.12s, transform 0.08s, box-shadow 0.12s;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #022c22;
      box-shadow: 0 8px 18px rgba(22, 163, 74, 0.35);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
    }

    .btn-soft {
      background: #020617;
      color: var(--text-main);
      border: 1px solid #1f2937;
    }

    .btn-soft:hover {
      background: #020617;
      transform: translateY(-1px);
    }

    .btn-danger-soft {
      background: var(--danger-soft);
      color: var(--danger);
      border: 1px solid rgba(248, 113, 113, 0.55);
    }

    .btn-sm {
      padding: 5px 11px;
      font-size: 11px;
    }

    .btn-xs {
      padding: 3px 9px;
      font-size: 11px;
    }

    .btn-icon {
      font-size: 13px;
    }

    .divider {
      margin: 12px 0 10px;
      height: 1px;
      background: #111827;
    }

    .tabela-wrapper {
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #111827;
      overflow: hidden;
      background: #020617;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    thead {
      background: #020617;
    }

    th,
    td {
      padding: 6px 8px;
      border-bottom: 1px solid #0b1120;
      text-align: left;
      vertical-align: middle;
    }

    th {
      font-weight: 500;
      color: var(--text-muted);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      background: #020617;
    }

    tbody tr:nth-child(even) {
      background: #020617;
    }

    tbody tr:nth-child(odd) {
      background: #000814;
    }

    tbody tr:hover {
      background: #020617;
    }

    .tag-status {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      font-size: 11px;
      background: var(--chip-bg);
      color: #e5e7eb;
    }

    .tag-status-danger {
      border-color: rgba(248, 113, 113, 0.9);
      background: var(--danger-soft);
      color: #fecaca;
    }

    .tag-status-warning {
      border-color: rgba(250, 204, 21, 0.8);
      background: var(--warning-soft);
      color: #fef9c3;
    }

    .tag-oferta {
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      cursor: pointer;
      min-width: 84px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .tag-oferta-lancado {
      border-color: rgba(34, 197, 94, 0.85);
      background: rgba(22, 163, 74, 0.15);
      color: #bbf7d0;
    }

    .checkbox-flag {
      width: 14px;
      height: 14px;
    }

    .table-header-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .filters-group {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .select-pill {
      background: #020617;
      border-radius: 999px;
      border: 1px solid #1f2937;
      padding: 3px 8px;
      color: var(--text-main);
      font-size: 12px;
    }

    .select-pill select {
      background: transparent;
      border: none;
      color: inherit;
      font-size: inherit;
      padding: 0;
    }

    .select-pill select:focus {
      outline: none;
      box-shadow: none;
    }

    .muted {
      color: var(--text-muted);
      font-size: 11px;
    }

    .total-itens {
      font-size: 11px;
      color: var(--text-muted);
      text-align: right;
      padding-right: 2px;
    }

    .text-right {
      text-align: right;
    }

    /* aumentar espa√ßo entre status e oferta */
    .col-status,
    .col-oferta {
      min-width: 110px;
    }

    /* LOGIN */
    .login-wrapper {
      max-width: 360px;
      margin: 60px auto;
      background: #020617;
      border-radius: 10px;
      padding: 16px 14px 18px;
      border: 1px solid #111827;
    }

    .login-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .login-title h1 {
      margin: 0;
      font-size: 16px;
    }

    .login-sub {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .alert {
      font-size: 12px;
      padding: 7px 9px;
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .alert-error {
      background: var(--danger-soft);
      border: 1px solid rgba(248, 113, 113, 0.7);
      color: #fecaca;
    }

    .alert-info {
      background: #020617;
      border: 1px solid #1f2937;
      color: var(--text-muted);
    }

    .login-footer {
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
    }

    .login-divider {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 10px 0;
    }

    .login-divider-line {
      flex: 1;
      height: 1px;
      background: #1f2937;
    }

    .login-divider-text {
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    /* MODAL SCANNER */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal {
      background: #020617;
      border-radius: 10px;
      padding: 14px 14px 16px;
      border: 1px solid #111827;
      width: 100%;
      max-width: 400px;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 14px;
    }

    .modal-body {
      font-size: 12px;
    }

    .scanner-container {
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #111827;
      margin-top: 8px;
      background: #020617;
    }

    #reader {
      width: 100%;
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header id="app-header" style="display:none;">
    <div class="brand">
      <div class="brand-icon">CV</div>
      <div>
        <div class="brand-text-title">Controle de Validade</div>
        <div class="brand-text-sub">Multi-loja ‚Ä¢ Acesso por perfil</div>
      </div>
    </div>
    <div class="user-info">
      <div><strong id="headerUserName">Usu√°rio</strong></div>
      <div class="user-role" id="headerUserRole">Perfil</div>
      <a class="link-logout" id="btnLogout">Sair</a>
    </div>
  </header>

  <main>
    <!-- LOGIN -->
    <div id="login-view">
      <div class="login-wrapper">
        <div class="login-title">
          <div class="brand-icon">CV</div>
          <div>
            <h1>Entrar</h1>
            <div class="login-sub">Controle interno de validade de produtos</div>
          </div>
        </div>

        <div id="loginError" class="alert alert-error" style="display:none;"></div>

        <div class="form-group">
          <label for="loginEmail">E-mail</label>
          <input type="email" id="loginEmail" placeholder="seu@email.com" />
        </div>
        <div class="form-group">
          <label for="loginPassword">Senha</label>
          <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>

        <div style="margin-top:10px; display:flex; flex-direction:column; gap:6px;">
          <button id="btnEmailLogin" class="btn btn-primary">
            <span class="btn-icon">üîê</span> Entrar com e-mail
          </button>
          <button id="btnGoogleLogin" class="btn btn-soft">
            <span class="btn-icon">‚ö°</span> Entrar com Google
          </button>
        </div>

        <div class="login-divider">
          <div class="login-divider-line"></div>
          <div class="login-divider-text">ou</div>
          <div class="login-divider-line"></div>
        </div>

        <div class="alert alert-info">
          Para usar o app, solicite seu cadastro ao administrador.
        </div>

        <div class="login-footer">
          Seu acesso √© individual. Admin v√™ todos os lan√ßamentos, gerente v√™ a
          loja dele, repositor v√™ apenas o que cadastrou.
        </div>
      </div>
    </div>

    <!-- APP -->
    <div id="app-view" style="display:none;">
      <div class="grid">
        <!-- CADASTRO -->
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">‚ûï</div>
                Novo lan√ßamento
              </div>
              <div class="card-subtitle">
                Registrar validade por loja, departamento e lote.
              </div>
            </div>
            <span class="badge-soft">
              <span class="badge-soft-dot"></span> Cadastro r√°pido
            </span>
          </div>

          <form id="cadastroForm">
            <div class="form-grid">
              <div class="form-group">
                <label>Loja<span class="required-star">*</span></label>
                <select id="loja">
                  <option value="">Selecione</option>
                  <option value="Ponta Verde">Ponta Verde</option>
                  <option value="Farol">Farol</option>
                  <option value="Praia">Praia</option>
                  <option value="Riomar">Riomar</option>
                  <option value="CD">CD</option>
                  <option value="Compras">Compras</option>
                </select>
              </div>

              <div class="form-group">
                <label>Data lan√ßamento</label>
                <input type="text" id="dataLancamento" readonly />
              </div>

              <div class="form-group">
                <label>Departamento<span class="required-star">*</span></label>
                <select id="departamento">
                  <option value="">Selecione</option>
                  <option value="A√ßougue">A√ßougue</option>
                  <option value="Adega">Adega</option>
                  <option value="Bebidas">Bebidas</option>
                  <option value="Mercearia Alimentos">Mercearia Alimentos</option>
                  <option value="Mercearia N√£o Alimentos">Mercearia N√£o Alimentos</option>
                  <option value="Perec√≠veis Processados">Perec√≠veis Processados</option>
                </select>
              </div>

              <div class="form-group">
                <label>C√≥d. barras (n√∫meros, m√°x. 13)<span class="required-star">*</span></label>
                <div class="input-inline">
                  <input
                    type="text"
                    id="codigoBarras"
                    maxlength="13"
                    inputmode="numeric"
                    pattern="[0-9]{1,13}"
                    placeholder="789..."
                    style="flex:1;"
                  />
                  <button type="button" id="btnScan" class="btn btn-soft btn-sm">
                    üì∑
                  </button>
                </div>
              </div>

              <div class="form-group">
                <label>Descri√ß√£o<span class="required-star">*</span></label>
                <input type="text" id="descricao" />
              </div>

              <div class="form-group">
                <label>Lote</label>
                <input type="text" id="lote" />
              </div>

              <div class="form-group">
                <label>Quantidade<span class="required-star">*</span></label>
                <input type="number" id="quantidade" min="0" />
              </div>

              <div class="form-group">
                <label>Validade<span class="required-star">*</span></label>
                <input type="date" id="validade" />
              </div>

              <div class="form-group" style="grid-column:1 / -1;">
                <label>Observa√ß√£o</label>
                <textarea id="observacao" placeholder="Lote em oferta, ponto extra, etc."></textarea>
              </div>
            </div>

            <div style="display:flex; justify-content:flex-end; margin-top:12px;">
              <button type="submit" class="btn btn-primary">
                <span class="btn-icon">üíæ</span> Salvar lan√ßamento
              </button>
            </div>
          </form>
        </div>

        <!-- ITENS CADASTRADOS -->
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">
                <div class="card-title-icon">üìã</div>
                Itens cadastrados
              </div>
              <div class="card-subtitle">
                Filtros por status de vencimento e controle de oferta.
              </div>
            </div>
            <div style="display:flex; gap:6px; flex-wrap:wrap;">
              <button id="btnMarcarTodosOferta" class="btn btn-soft btn-sm">
                üì£ Marcar todos como oferta
              </button>
              <button id="btnExportExcel" class="btn btn-soft btn-sm">
                üìä Excel
              </button>
              <button id="btnExportPdf" class="btn btn-soft btn-sm">
                üìÑ PDF
              </button>
            </div>
          </div>

          <div class="table-header-actions">
            <div class="filters-group">
              <span class="muted">Filtros:</span>
              <div class="select-pill">
                <select id="filtroVencimento">
                  <option value="todos">Todos</option>
                  <option value="7">Vence em 7 dias</option>
                  <option value="15">Vence em 15 dias</option>
                  <option value="30">Vence em 30 dias</option>
                  <option value="vencidos">Vencidos</option>
                </select>
              </div>
              <div class="select-pill">
                <select id="filtroDepartamento">
                  <option value="todos">Todos departamentos</option>
                  <option value="A√ßougue">A√ßougue</option>
                  <option value="Adega">Adega</option>
                  <option value="Bebidas">Bebidas</option>
                  <option value="Mercearia Alimentos">Mercearia Alimentos</option>
                  <option value="Mercearia N√£o Alimentos">Mercearia N√£o Alimentos</option>
                  <option value="Perec√≠veis Processados">Perec√≠veis Processados</option>
                </select>
              </div>
            </div>
            <div class="total-itens" id="totalItens">Total de itens: 0</div>
          </div>

          <div class="tabela-wrapper">
            <table id="tabelaCadastros">
              <thead>
              <tr>
                <th>Loja</th>
                <th>Data lan√ßamento</th>
                <th>Departamento</th>
                <th>C√≥d. barras</th>
                <th>Descri√ß√£o</th>
                <th>Qtd</th>
                <th>Validade</th>
                <th class="col-status">Status</th>
                <th class="col-oferta">Oferta</th>
                <th>Flag</th>
                <th>Lote</th>
                <th>Usu√°rio</th>
                <th>Lan√ßado em</th>
                <th>Obs.</th>
                <th class="text-right">A√ß√µes</th>
              </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ADMIN USU√ÅRIOS -->
      <div class="card" id="adminUsuariosCard" style="margin-top:14px; display:none;">
        <div class="card-header">
          <div>
            <div class="card-title">
              <div class="card-title-icon">üõ°Ô∏è</div>
              Administra√ß√£o de usu√°rios
            </div>
            <div class="card-subtitle">
              Gerencie perfis (admin, gerente, repositor) e lojas vinculadas.
            </div>
          </div>
          <button id="btnReloadUsers" class="btn btn-soft btn-sm">üîÑ Recarregar</button>
        </div>

        <div class="divider"></div>

        <div style="margin-bottom:8px; font-size:13px; font-weight:500;">
          Cadastrar novo usu√°rio
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Nome</label>
            <input type="text" id="admNome" />
          </div>
          <div class="form-group">
            <label>E-mail</label>
            <input type="email" id="admEmail" />
          </div>
          <div class="form-group">
            <label>Perfil</label>
            <select id="admPerfil">
              <option value="repositor">Repositor</option>
              <option value="gerente">Gerente</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <div class="form-group">
            <label>Loja</label>
            <select id="admLoja">
              <option value="">Nenhuma</option>
              <option value="Ponta Verde">Ponta Verde</option>
              <option value="Farol">Farol</option>
              <option value="Praia">Praia</option>
              <option value="Riomar">Riomar</option>
              <option value="CD">CD</option>
              <option value="Compras">Compras</option>
            </select>
          </div>
        </div>

        <div style="margin-top:8px; display:flex; justify-content:flex-end;">
          <button id="btnSalvarNovoUsuario" class="btn btn-primary btn-sm">
            ‚ûï Salvar usu√°rio
          </button>
        </div>

        <div class="divider" style="margin-top:12px;"></div>

        <table id="tabelaUsuarios" style="font-size:12px; margin-top:4px;">
          <thead>
          <tr>
            <th>Nome</th>
            <th>E-mail</th>
            <th>Perfil</th>
            <th>Loja</th>
            <th class="text-right">A√ß√µes</th>
          </tr>
          </thead>
          <tbody></tbody>
        </table>

        <div class="total-itens" id="totalUsuarios">
          Nenhum usu√°rio cadastrado na cole√ß√£o usuarios.
        </div>
      </div>
    </div>
  </main>
</div>

<!-- MODAL SCANNER -->
<div id="scannerModal" style="display:none;"></div>

<!-- libs -->
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import {
    getAuth,
    onAuthStateChanged,
    signOut,
    signInWithEmailAndPassword,
    GoogleAuthProvider,
    signInWithPopup,
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import {
    getFirestore,
    collection,
    doc,
    getDoc,
    getDocs,
    setDoc,
    addDoc,
    updateDoc,
    deleteDoc,
    serverTimestamp,
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDa1z9LwlSHxwSTC974ci9RMEYdEiA_wEg",
    authDomain: "controle-validade-fc108.firebaseapp.com",
    projectId: "controle-validade-fc108",
    storageBucket: "controle-validade-fc108.firebasestorage.app",
    messagingSenderId: "737065688686",
    appId: "1:737065688686:web:ed3e602baf64c1fb4f907f",
    measurementId: "G-VJ8DMM47EN",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentUserProfile = null;
  let cadastrosCache = [];
  let usersCache = [];
  let html5QrCode = null;

  // ELEMENTOS
  const loginView = document.getElementById("login-view");
  const appView = document.getElementById("app-view");
  const appHeader = document.getElementById("app-header");
  const headerUserName = document.getElementById("headerUserName");
  const headerUserRole = document.getElementById("headerUserRole");
  const loginError = document.getElementById("loginError");

  const loginEmail = document.getElementById("loginEmail");
  const loginPassword = document.getElementById("loginPassword");
  const btnEmailLogin = document.getElementById("btnEmailLogin");
  const btnGoogleLogin = document.getElementById("btnGoogleLogin");
  const btnLogout = document.getElementById("btnLogout");

  const lojaInput = document.getElementById("loja");
  const dataLancInput = document.getElementById("dataLancamento");
  const departamentoInput = document.getElementById("departamento");
  const codigoBarrasInput = document.getElementById("codigoBarras");
  const descricaoInput = document.getElementById("descricao");
  const loteInput = document.getElementById("lote");
  const qtdInput = document.getElementById("quantidade");
  const validadeInput = document.getElementById("validade");
  const obsInput = document.getElementById("observacao");
  const cadastroForm = document.getElementById("cadastroForm");

  const tabelaCadastrosBody = document.querySelector("#tabelaCadastros tbody");
  const filtroVencimento = document.getElementById("filtroVencimento");
  const filtroDepartamento = document.getElementById("filtroDepartamento");
  const totalItensLabel = document.getElementById("totalItens");

  const adminCard = document.getElementById("adminUsuariosCard");
  const tabelaUsuariosBody = document.querySelector("#tabelaUsuarios tbody");
  const totalUsuariosLabel = document.getElementById("totalUsuarios");

  const scannerModal = document.getElementById("scannerModal");
  const btnScan = document.getElementById("btnScan");

  // FUN√á√ïES AUXILIARES
  function showError(msg) {
    loginError.style.display = "block";
    loginError.textContent = msg;
  }

  function clearError() {
    loginError.style.display = "none";
    loginError.textContent = "";
  }

  function translateRole(tipo) {
    if (tipo === "admin") return "Admin";
    if (tipo === "gerente") return "Gerente";
    return "Repositor";
  }

  function setLoggedInUI(isLogged) {
    if (isLogged) {
      loginView.style.display = "none";
      appView.style.display = "block";
      appHeader.style.display = "flex";
    } else {
      loginView.style.display = "block";
      appView.style.display = "none";
      appHeader.style.display = "none";
    }
  }

  function atualizarHeader() {
    if (!currentUserProfile) return;
    headerUserName.textContent =
      currentUserProfile.nome || auth.currentUser?.email || "Usu√°rio";
    headerUserRole.textContent = `Perfil: ${translateRole(
      currentUserProfile.tipo
    )}`;
  }

  function preencherDataLancamento() {
    const now = new Date();
    const dia = String(now.getDate()).padStart(2, "0");
    const mes = String(now.getMonth() + 1).padStart(2, "0");
    const ano = now.getFullYear();
    const hora = String(now.getHours()).padStart(2, "0");
    const min = String(now.getMinutes()).padStart(2, "0");
    dataLancInput.value = `${dia}/${mes}/${ano} ${hora}:${min}`;
  }

  function formatarDataHora(date) {
    const dia = String(date.getDate()).padStart(2, "0");
    const mes = String(date.getMonth() + 1).padStart(2, "0");
    const ano = date.getFullYear();
    const hora = String(date.getHours()).padStart(2, "0");
    const min = String(date.getMinutes()).padStart(2, "0");
    return `${dia}/${mes}/${ano} ${hora}:${min}`;
  }

  async function ensureUserProfile(user) {
    if (!user) return null;
    const userRef = doc(db, "usuarios", user.uid);
    const snap = await getDoc(userRef);
    if (!snap.exists()) {
      const data = {
        email: user.email,
        nome: user.displayName || "",
        tipo: "repositor",
        loja: "",
        criadoEm: serverTimestamp(),
      };
      await setDoc(userRef, data);
      return data;
    }
    return snap.data();
  }

  async function loadUserProfile(user) {
    if (!user) return null;
    const userRef = doc(db, "usuarios", user.uid);
    const snap = await getDoc(userRef);
    if (!snap.exists()) return await ensureUserProfile(user);
    return snap.data();
  }

  function toggleAdminCard() {
    if (currentUserProfile && currentUserProfile.tipo === "admin") {
      adminCard.style.display = "block";
    } else {
      adminCard.style.display = "none";
    }
  }

  // LOGIN
  btnEmailLogin.addEventListener("click", async () => {
    clearError();
    const email = loginEmail.value.trim();
    const pass = loginPassword.value.trim();
    if (!email || !pass) {
      showError("Informe e-mail e senha.");
      return;
    }
    try {
      const cred = await signInWithEmailAndPassword(auth, email, pass);
      await ensureUserProfile(cred.user);
    } catch (e) {
      console.error(e);
      showError("Erro ao entrar. Verifique as credenciais.");
    }
  });

  const provider = new GoogleAuthProvider();
  btnGoogleLogin.addEventListener("click", async () => {
    clearError();
    try {
      const cred = await signInWithPopup(auth, provider);
      await ensureUserProfile(cred.user);
    } catch (e) {
      console.error(e);
      showError("Erro ao entrar com Google.");
    }
  });

  btnLogout.addEventListener("click", async () => {
    await signOut(auth);
  });

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      currentUserProfile = null;
      setLoggedInUI(false);
      return;
    }
    currentUserProfile = await loadUserProfile(user);
    setLoggedInUI(true);
    atualizarHeader();
    preencherDataLancamento();
    await carregarCadastros();
    await carregarUsuariosAdmin();
    toggleAdminCard();
  });

  // VALIDA√á√ïES
  function validarCodigoBarras(valor) {
    if (!valor) return false;
    if (!/^[0-9]+$/.test(valor)) return false;
    if (valor.length > 13) return false;
    return true;
  }

  // CADASTRO
  cadastroForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    if (!auth.currentUser || !currentUserProfile) {
      alert("Fa√ßa login novamente.");
      return;
    }

    const loja = lojaInput.value.trim();
    const departamento = departamentoInput.value.trim();
    const codigo = codigoBarrasInput.value.trim();
    const descricao = descricaoInput.value.trim();
    const lote = loteInput.value.trim();
    const qtd = Number(qtdInput.value || "0");
    const validade = validadeInput.value;
    const obs = obsInput.value.trim();

    if (!loja || !departamento || !codigo || !descricao || !validade) {
      alert("Preencha todos os campos obrigat√≥rios.");
      return;
    }
    if (!validarCodigoBarras(codigo)) {
      alert("C√≥digo de barras inv√°lido. Use apenas n√∫meros, at√© 13 d√≠gitos.");
      return;
    }

    const docData = {
      loja,
      dataLancamentoTexto: dataLancInput.value,
      dataLancamento: serverTimestamp(),
      departamento,
      codigoBarras: codigo,
      descricao,
      lote,
      quantidade: qtd,
      validade,
      observacao: obs,
      oferta: "N√£o Lan√ßado",
      flagOferta: false,
      criadoPorUid: auth.currentUser.uid,
      criadoPorNome: currentUserProfile.nome || auth.currentUser.email,
      criadoEm: serverTimestamp(),
    };

    try {
      await addDoc(collection(db, "cadastros"), docData);
      preencherDataLancamento();
      codigoBarrasInput.value = "";
      descricaoInput.value = "";
      loteInput.value = "";
      qtdInput.value = "";
      validadeInput.value = "";
      obsInput.value = "";
      await carregarCadastros();
    } catch (err) {
      console.error(err);
      alert("Erro ao salvar lan√ßamento.");
    }
  });

  // CARREGAR CADASTROS
  filtroVencimento.addEventListener("change", renderTabelaCadastros);
  filtroDepartamento.addEventListener("change", renderTabelaCadastros);

  async function carregarCadastros() {
    if (!auth.currentUser || !currentUserProfile) return;
    const snap = await getDocs(collection(db, "cadastros"));
    cadastrosCache = snap.docs.map((d) => ({ id: d.id, ...d.data() }));

    // ordena client-side por criadoEm (se tiver)
    cadastrosCache.sort((a, b) => {
      const ta = a.criadoEm?.seconds || 0;
      const tb = b.criadoEm?.seconds || 0;
      return tb - ta;
    });

    renderTabelaCadastros();
  }

  function calcularStatus(validadeStr) {
    if (!validadeStr) return { label: "-", classe: "" };
    const hoje = new Date();
    hoje.setHours(0, 0, 0, 0);

    const [ano, mes, dia] = validadeStr.split("-");
    const dataVal = new Date(Number(ano), Number(mes) - 1, Number(dia));
    const diffMs = dataVal.getTime() - hoje.getTime();
    const diffDias = Math.round(diffMs / (1000 * 60 * 60 * 24));

    if (diffDias < 0) return { label: "Vencido", classe: "tag-status-danger" };
    if (diffDias === 0)
      return { label: "Vence hoje", classe: "tag-status-danger" };
    if (diffDias <= 7)
      return { label: `Vence em ${diffDias} dia(s)`, classe: "tag-status-danger" };
    if (diffDias <= 15)
      return { label: `Vence em ${diffDias} dia(s)`, classe: "tag-status-warning" };
    if (diffDias <= 30)
      return { label: `Vence em ${diffDias} dia(s)`, classe: "tag-status" };
    return { label: `Vence em ${diffDias} dia(s)`, classe: "tag-status" };
  }

  function aplicaFiltroVencimento(item) {
    const filtro = filtroVencimento.value;
    if (filtro === "todos") return true;

    if (!item.validade) return false;

    const hoje = new Date();
    hoje.setHours(0, 0, 0, 0);
    const [ano, mes, dia] = item.validade.split("-");
    const dataVal = new Date(Number(ano), Number(mes) - 1, Number(dia));
    const diffDias = Math.round(
      (dataVal.getTime() - hoje.getTime()) / (1000 * 60 * 60 * 24)
    );

    if (filtro === "vencidos") return diffDias < 0;
    const limite = Number(filtro);
    return diffDias >= 0 && diffDias <= limite;
  }

  function renderTabelaCadastros() {
    tabelaCadastrosBody.innerHTML = "";
    let lista = [...cadastrosCache];

    // VISIBILIDADE POR PERFIL (agora s√≥ aqui, os dados v√™m todos do banco)
    if (currentUserProfile) {
      if (currentUserProfile.tipo === "gerente") {
        const lojaGerente = currentUserProfile.loja || "";
        lista = lista.filter((it) => it.loja === lojaGerente);
      } else if (currentUserProfile.tipo === "repositor") {
        const uid = auth.currentUser?.uid;
        lista = lista.filter((it) => it.criadoPorUid === uid);
      } // admin v√™ tudo
    }

    // filtros de tela
    if (filtroDepartamento.value !== "todos") {
      lista = lista.filter(
        (it) => it.departamento === filtroDepartamento.value
      );
    }
    lista = lista.filter((it) => aplicaFiltroVencimento(it));

    totalItensLabel.textContent = `Total de itens: ${lista.length}`;

    for (const item of lista) {
      const tr = document.createElement("tr");
      const status = calcularStatus(item.validade);
      const oferta = item.oferta || "N√£o Lan√ßado";
      const usuario = item.criadoPorNome || "-";

      const dataLanc =
        item.dataLancamentoTexto ||
        (item.criadoEm?.toDate ? formatarDataHora(item.criadoEm.toDate()) : "-");

      tr.innerHTML = `
        <td>${item.loja || ""}</td>
        <td>${dataLanc}</td>
        <td>${item.departamento || ""}</td>
        <td>${item.codigoBarras || ""}</td>
        <td>${item.descricao || ""}</td>
        <td>${item.quantidade ?? ""}</td>
        <td>${
          item.validade ? item.validade.split("-").reverse().join("/") : ""
        }</td>
        <td class="col-status">
          <span class="tag-status ${status.classe}">${status.label}</span>
        </td>
        <td class="col-oferta">
          <button class="tag-oferta ${
            oferta === "Lan√ßado" ? "tag-oferta-lancado" : ""
          }" data-id="${item.id}">
            ${oferta}
          </button>
        </td>
        <td>
          <input type="checkbox" class="checkbox-flag" data-flag-id="${
            item.id
          }" ${item.flagOferta ? "checked" : ""} />
        </td>
        <td>${item.lote || ""}</td>
        <td>${usuario}</td>
        <td>${dataLanc}</td>
        <td>${item.observacao || ""}</td>
        <td class="text-right">
          <button class="btn btn-soft btn-xs" data-editar-id="${item.id}">
            Editar
          </button>
          ${
            currentUserProfile && currentUserProfile.tipo === "admin"
              ? `<button class="btn btn-danger-soft btn-xs" data-excluir-id="${item.id}">
                   Excluir
                 </button>`
              : ""
          }
        </td>
      `;
      tabelaCadastrosBody.appendChild(tr);
    }
  }

  tabelaCadastrosBody.addEventListener("click", async (e) => {
    const ofertaBtn = e.target.closest(".tag-oferta");
    if (ofertaBtn) {
      const id = ofertaBtn.getAttribute("data-id");
      const item = cadastrosCache.find((c) => c.id === id);
      if (!item) return;
      const novoStatus = item.oferta === "Lan√ßado" ? "N√£o Lan√ßado" : "Lan√ßado";
      await updateDoc(doc(db, "cadastros", id), { oferta: novoStatus });
      item.oferta = novoStatus;
      renderTabelaCadastros();
      return;
    }

    const excluirId = e.target.getAttribute("data-excluir-id");
    if (excluirId) {
      if (!currentUserProfile || currentUserProfile.tipo !== "admin") return;
      if (!confirm("Confirma excluir este lan√ßamento?")) return;
      await deleteDoc(doc(db, "cadastros", excluirId));
      cadastrosCache = cadastrosCache.filter((c) => c.id !== excluirId);
      renderTabelaCadastros();
      return;
    }

    const editarId = e.target.getAttribute("data-editar-id");
    if (editarId) {
      alert("Edi√ß√£o de itens ainda n√£o implementada nesta vers√£o.");
      return;
    }
  });

  tabelaCadastrosBody.addEventListener("change", async (e) => {
    const flagId = e.target.getAttribute("data-flag-id");
    if (!flagId) return;
    const checked = e.target.checked;
    await updateDoc(doc(db, "cadastros", flagId), { flagOferta: checked });
    const item = cadastrosCache.find((c) => c.id === flagId);
    if (item) item.flagOferta = checked;
  });

  document
    .getElementById("btnMarcarTodosOferta")
    .addEventListener("click", async () => {
      if (!cadastrosCache.length) return;
      if (!confirm("Marcar todos os itens (vis√≠veis) como oferta 'Lan√ßado'?"))
        return;

      // aplica mesma visibilidade do render
      let lista = [...cadastrosCache];
      if (currentUserProfile) {
        if (currentUserProfile.tipo === "gerente") {
          lista = lista.filter(
            (it) => it.loja === (currentUserProfile.loja || "")
          );
        } else if (currentUserProfile.tipo === "repositor") {
          lista = lista.filter(
            (it) => it.criadoPorUid === auth.currentUser?.uid
          );
        }
      }
      if (filtroDepartamento.value !== "todos") {
        lista = lista.filter(
          (it) => it.departamento === filtroDepartamento.value
        );
      }
      lista = lista.filter((it) => aplicaFiltroVencimento(it));

      for (const item of lista) {
        await updateDoc(doc(db, "cadastros", item.id), { oferta: "Lan√ßado" });
        item.oferta = "Lan√ßado";
      }
      renderTabelaCadastros();
    });

  // EXPORTA√á√ïES
  document
    .getElementById("btnExportExcel")
    .addEventListener("click", () => exportarExcel());
  document
    .getElementById("btnExportPdf")
    .addEventListener("click", () => exportarPdf());

  function getDadosFiltrados() {
    let lista = [...cadastrosCache];

    if (currentUserProfile) {
      if (currentUserProfile.tipo === "gerente") {
        lista = lista.filter(
          (it) => it.loja === (currentUserProfile.loja || "")
        );
      } else if (currentUserProfile.tipo === "repositor") {
        lista = lista.filter(
          (it) => it.criadoPorUid === auth.currentUser?.uid
        );
      }
    }
    if (filtroDepartamento.value !== "todos") {
      lista = lista.filter(
        (it) => it.departamento === filtroDepartamento.value
      );
    }
    lista = lista.filter((it) => aplicaFiltroVencimento(it));
    return lista;
  }

  function exportarExcel() {
    const dados = getDadosFiltrados().map((item) => ({
      Loja: item.loja || "",
      "Data lan√ßamento":
        item.dataLancamentoTexto ||
        (item.criadoEm?.toDate ? formatarDataHora(item.criadoEm.toDate()) : ""),
      Departamento: item.departamento || "",
      "C√≥d. barras": item.codigoBarras || "",
      Descri√ß√£o: item.descricao || "",
      Quantidade: item.quantidade ?? "",
      Validade: item.validade
        ? item.validade.split("-").reverse().join("/")
        : "",
      Status: calcularStatus(item.validade).label,
      Oferta: item.oferta || "N√£o Lan√ßado",
      Flag: item.flagOferta ? "Sim" : "N√£o",
      Lote: item.lote || "",
      Usu√°rio: item.criadoPorNome || "",
      "Lan√ßado em":
        item.dataLancamentoTexto ||
        (item.criadoEm?.toDate ? formatarDataHora(item.criadoEm.toDate()) : ""),
      Observa√ß√£o: item.observacao || "",
    }));

    const ws = XLSX.utils.json_to_sheet(dados);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Validades");
    XLSX.writeFile(wb, "controle-validade.xlsx");
  }

  function exportarPdf() {
    const { jsPDF } = window.jspdf;
    const docPdf = new jsPDF("l", "pt", "a4");

    const dados = getDadosFiltrados().map((item) => [
      item.loja || "",
      item.dataLancamentoTexto ||
        (item.criadoEm?.toDate ? formatarDataHora(item.criadoEm.toDate()) : ""),
      item.departamento || "",
      item.codigoBarras || "",
      item.descricao || "",
      item.quantidade ?? "",
      item.validade
        ? item.validade.split("-").reverse().join("/")
        : "",
      calcularStatus(item.validade).label,
      item.oferta || "N√£o Lan√ßado",
      item.flagOferta ? "Sim" : "N√£o",
      item.lote || "",
      item.criadoPorNome || "",
    ]);

    docPdf.setFontSize(12);
    docPdf.text("Relat√≥rio - Controle de Validade", 40, 35);

    docPdf.autoTable({
      startY: 45,
      head: [
        [
          "Loja",
          "Lan√ßamento",
          "Depto",
          "C√≥d.",
          "Descri√ß√£o",
          "Qtd",
          "Validade",
          "Status",
          "Oferta",
          "Flag",
          "Lote",
          "Usu√°rio",
        ],
      ],
      body: dados,
      styles: { fontSize: 8 },
      headStyles: { fillColor: [15, 23, 42] },
    });

    docPdf.save("controle-validade.pdf");
  }

  // ADMIN USU√ÅRIOS
  document
    .getElementById("btnReloadUsers")
    .addEventListener("click", carregarUsuariosAdmin);
  document
    .getElementById("btnSalvarNovoUsuario")
    .addEventListener("click", salvarNovoUsuario);

  async function carregarUsuariosAdmin() {
    if (!currentUserProfile || currentUserProfile.tipo !== "admin") return;
    const snap = await getDocs(collection(db, "usuarios"));
    usersCache = snap.docs.map((d) => ({ id: d.id, ...d.data() }));
    renderTabelaUsuarios();
  }

  function renderTabelaUsuarios() {
    tabelaUsuariosBody.innerHTML = "";
    if (!usersCache.length) {
      totalUsuariosLabel.textContent =
        "Nenhum usu√°rio cadastrado na cole√ß√£o usuarios.";
      return;
    }
    totalUsuariosLabel.textContent = `Total de usu√°rios: ${usersCache.length}`;

    for (const u of usersCache) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${u.nome || u.email || ""}</td>
        <td>${u.email || ""}</td>
        <td>
          <select data-user-id="${u.id}" data-field="tipo">
            <option value="repositor" ${
              u.tipo === "repositor" ? "selected" : ""
            }>Repositor</option>
            <option value="gerente" ${
              u.tipo === "gerente" ? "selected" : ""
            }>Gerente</option>
            <option value="admin" ${
              u.tipo === "admin" ? "selected" : ""
            }>Admin</option>
          </select>
        </td>
        <td>
          <select data-user-id="${u.id}" data-field="loja">
            <option value="" ${!u.loja ? "selected" : ""}>Nenhuma</option>
            <option value="Ponta Verde" ${
              u.loja === "Ponta Verde" ? "selected" : ""
            }>Ponta Verde</option>
            <option value="Farol" ${
              u.loja === "Farol" ? "selected" : ""
            }>Farol</option>
            <option value="Praia" ${
              u.loja === "Praia" ? "selected" : ""
            }>Praia</option>
            <option value="Riomar" ${
              u.loja === "Riomar" ? "selected" : ""
            }>Riomar</option>
            <option value="CD" ${u.loja === "CD" ? "selected" : ""}>CD</option>
            <option value="Compras" ${
              u.loja === "Compras" ? "selected" : ""
            }>Compras</option>
          </select>
        </td>
        <td class="text-right">
          <button class="btn btn-soft btn-xs" data-salvar-usuario="${u.id}">
            Salvar
          </button>
          <button class="btn btn-danger-soft btn-xs" data-excluir-usuario="${u.id}">
            Excluir
          </button>
        </td>
      `;
      tabelaUsuariosBody.appendChild(tr);
    }
  }

  async function salvarNovoUsuario() {
    const nome = document.getElementById("admNome").value.trim();
    const email = document.getElementById("admEmail").value.trim();
    const tipo = document.getElementById("admPerfil").value;
    const loja = document.getElementById("admLoja").value;

    if (!email) {
      alert("Informe o e-mail.");
      return;
    }

    const data = { nome, email, tipo, loja, criadoEm: serverTimestamp() };
    await addDoc(collection(db, "usuarios"), data);

    document.getElementById("admNome").value = "";
    document.getElementById("admEmail").value = "";
    document.getElementById("admPerfil").value = "repositor";
    document.getElementById("admLoja").value = "";

    await carregarUsuariosAdmin();
  }

  tabelaUsuariosBody.addEventListener("click", async (e) => {
    const salvarId = e.target.getAttribute("data-salvar-usuario");
    const excluirId = e.target.getAttribute("data-excluir-usuario");

    if (salvarId) {
      const tipoSelect = tabelaUsuariosBody.querySelector(
        `select[data-user-id="${salvarId}"][data-field="tipo"]`
      );
      const lojaSelect = tabelaUsuariosBody.querySelector(
        `select[data-user-id="${salvarId}"][data-field="loja"]`
      );

      await updateDoc(doc(db, "usuarios", salvarId), {
        tipo: tipoSelect.value,
        loja: lojaSelect.value,
      });

      if (auth.currentUser && auth.currentUser.uid === salvarId) {
        currentUserProfile = await loadUserProfile(auth.currentUser);
        atualizarHeader();
        toggleAdminCard();
        await carregarCadastros();
      }

      alert("Usu√°rio atualizado.");
      return;
    }

    if (excluirId) {
      if (!confirm("Excluir usu√°rio da cole√ß√£o usuarios?")) return;
      await deleteDoc(doc(db, "usuarios", excluirId));
      usersCache = usersCache.filter((u) => u.id !== excluirId);
      renderTabelaUsuarios();
    }
  });

  // SCANNER ‚Äì agora for√ßa c√¢mera traseira
  btnScan.addEventListener("click", () => {
    abrirScanner();
  });

  function abrirScanner() {
    scannerModal.innerHTML = `
      <div class="modal-backdrop">
        <div class="modal">
          <div class="modal-header">
            <h2>Scanner de c√≥digo de barras</h2>
            <button id="btnFecharScanner" class="btn btn-soft btn-xs">Fechar</button>
          </div>
          <div class="modal-body">
            Aponte a c√¢mera para o c√≥digo de barras do produto.
            <div class="scanner-container">
              <div id="reader"></div>
            </div>
          </div>
        </div>
      </div>
    `;
    scannerModal.style.display = "block";

    Html5Qrcode.getCameras()
      .then((devices) => {
        if (!devices || devices.length === 0) {
          alert("Nenhuma c√¢mera encontrada.");
          fecharScanner();
          return;
        }

        // tenta achar 'back', se n√£o tiver pega a √∫ltima (geralmente traseira)
        let device = devices.find((d) =>
          d.label.toLowerCase().includes("back")
        );
        if (!device) device = devices[devices.length - 1];

        html5QrCode = new Html5Qrcode("reader");
        const config = { fps: 10, qrbox: { width: 250, height: 150 } };

        html5QrCode
          .start(
            device.id,
            config,
            (decodedText) => {
              const clean = decodedText.replace(/\D/g, "").slice(0, 13);
              if (clean) {
                codigoBarrasInput.value = clean;
              }
              fecharScanner();
            },
            () => {}
          )
          .catch((err) => {
            console.error(err);
            alert("Leitor de c√≥digo de barras n√£o carregou corretamente.");
            fecharScanner();
          });
      })
      .catch((err) => {
        console.error(err);
        alert("Erro ao acessar as c√¢meras do dispositivo.");
        fecharScanner();
      });

    document
      .getElementById("btnFecharScanner")
      .addEventListener("click", fecharScanner);
  }

  function fecharScanner() {
    if (html5QrCode) {
      html5QrCode.stop().catch(() => {});
      html5QrCode.clear().catch(() => {});
      html5QrCode = null;
    }
    scannerModal.style.display = "none";
    scannerModal.innerHTML = "";
  }
</script>
</body>
</html>
